<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gladde ijzelweg simulator: Baby & Boor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; touch-action: none; background: #e0f7fa; }
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; display: flex; flex-direction: column;
            align-items: center; padding: 20px; z-index: 10;
        }
        .overlay-card {
            background: rgba(255, 255, 255, 0.95); padding: 20px; border-radius: 15px;
            pointer-events: auto; text-align: center; backdrop-filter: blur(10px);
            border: 3px solid #0077be; max-width: 90%;
        }
        #drill-progress-container {
            width: 200px; height: 10px; background: #ddd; border-radius: 5px; margin-top: 10px; display: none;
        }
        #drill-progress-bar {
            width: 0%; height: 100%; background: #f1c40f; border-radius: 5px; transition: width 0.1s;
        }
        .control-btn {
            width: 65px; height: 65px; background: rgba(0, 119, 190, 0.85);
            color: white; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; font-size: 24px; touch-action: none;
            pointer-events: auto; border: 2px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        #mobile-controls {
            position: fixed; bottom: 20px; width: 100%; display: flex;
            justify-content: space-evenly; pointer-events: none; z-index: 999;
        }
    </style>
</head>
<body>

<div id="ui-layer">
    <div class="flex flex-col items-center pointer-events-none">
        <div class="text-xl font-bold text-blue-900 bg-white/50 px-4 py-1 rounded-full mb-2">WINTER DORP SIMULATOR</div>
        <div id="stats" class="text-sm font-bold grid grid-cols-2 gap-4 bg-white/80 p-3 rounded-lg border border-blue-200">
            <div>Afstand: <span id="dist-val">0</span>m</div>
            <div>Gladheid: <span id="slip-val">1.0</span>x</div>
            <div>Baby: <span id="baby-status">Slapend</span></div>
            <div>Gaten geboord: <span id="drill-count">0</span></div>
        </div>
        
        <div id="drill-progress-container">
            <div class="text-[10px] font-bold text-center uppercase">Aan het boren...</div>
            <div id="drill-progress-bar"></div>
        </div>
    </div>

    <div id="start-screen" class="overlay-card mt-20">
        <h1 class="text-2xl font-bold mb-2">Gevaarlijk Glad Dorp</h1>
        <p class="text-sm mb-4">Draag de baby door de besneeuwde straten. Stop op de <b>rode plekken</b> om gaten te boren. Pas op: hoe verder je komt, hoe minder grip je hebt!</p>
        <button class="bg-blue-600 text-white px-8 py-3 rounded-full font-bold hover:bg-blue-700 transition" onclick="startGame()">VERLAAT HET HUIS</button>
    </div>

    <div id="game-over-screen" class="overlay-card mt-20" style="display: none;">
        <h2 class="text-3xl font-bold text-red-600">UITGEGLEDEN!</h2>
        <p id="death-reason" class="my-4"></p>
        <button class="bg-blue-600 text-white px-8 py-3 rounded-full font-bold" onclick="location.reload()">PROBEER OPNIEUW</button>
    </div>
</div>

<div id="mobile-controls">
    <div class="control-btn" id="left-btn">←</div>
    <div class="control-btn" style="background: #27ae60" id="up-btn">↑</div>
    <div class="control-btn" style="background: #e67e22" id="drill-btn">⚒</div>
    <div class="control-btn" id="right-btn">→</div>
</div>

<script>
    let scene, camera, renderer, player, baby, environmentGroup;
    let drillPoints = [];
    let balance = 0, distance = 0, slipFactor = 1.0;
    let isGameOver = false, isStarted = false;
    let drillProgress = 0, isDrilling = false, drilledCount = 0;
    let babyMood = 0; 
    let lastZPos = 0;

    const keys = { left: false, right: false, up: false, drill: false };

    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0xd0eef5);
        scene.fog = new THREE.Fog(0xd0eef5, 5, 80);

        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        scene.add(new THREE.AmbientLight(0xffffff, 0.7));
        const sun = new THREE.DirectionalLight(0xffffff, 0.9);
        sun.position.set(20, 40, 20);
        sun.castShadow = true;
        scene.add(sun);

        environmentGroup = new THREE.Group();
        scene.add(environmentGroup);

        createPlayerAndBaby();
        createGround();
        
        // Eerste set omgeving objecten
        for(let z = 0; z > -150; z -= 15) {
            spawnEnvironmentRow(z);
        }

        setupControls();
        window.addEventListener('resize', onWindowResize);
        animate();
    }

    function createPlayerAndBaby() {
        player = new THREE.Group();
        
        // Mens
        const body = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.8, 0.3), new THREE.MeshPhongMaterial({ color: 0x2c3e50 }));
        body.position.y = 1.0;
        player.add(body);

        const head = new THREE.Mesh(new THREE.BoxGeometry(0.3, 0.3, 0.3), new THREE.MeshPhongMaterial({ color: 0xffdbac }));
        head.position.y = 1.6;
        player.add(head);

        // Baby
        baby = new THREE.Group();
        const babyBody = new THREE.Mesh(new THREE.BoxGeometry(0.25, 0.35, 0.2), new THREE.MeshPhongMaterial({ color: 0x3498db }));
        baby.add(babyBody);
        const babyHead = new THREE.Mesh(new THREE.SphereGeometry(0.12, 16, 16), new THREE.MeshPhongMaterial({ color: 0xffdbac }));
        babyHead.position.y = 0.25;
        baby.add(babyHead);
        
        baby.position.set(0, 1.1, 0.2);
        player.add(baby);

        scene.add(player);
    }

    function createGround() {
        const groundGeo = new THREE.PlaneGeometry(100, 2000);
        const groundMat = new THREE.MeshPhongMaterial({ color: 0xffffff, shininess: 50 });
        const ground = new THREE.Mesh(groundGeo, groundMat);
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);

        // Weg markering
        const roadGeo = new THREE.PlaneGeometry(4, 2000);
        const roadMat = new THREE.MeshPhongMaterial({ color: 0xe0e0e0, shininess: 80 });
        const road = new THREE.Mesh(roadGeo, roadMat);
        road.rotation.x = -Math.PI / 2;
        road.position.y = 0.01;
        scene.add(road);
    }

    function spawnEnvironmentRow(z) {
        // Huizen links/rechts
        if (Math.random() > 0.4) spawnHouse(8, z);
        if (Math.random() > 0.4) spawnHouse(-8, z);

        // Bomen
        for(let i=0; i<3; i++) {
            spawnTree(12 + Math.random()*10, z + (Math.random()-0.5)*10);
            spawnTree(-12 - Math.random()*10, z + (Math.random()-0.5)*10);
        }

        // Lantaarnpalen
        if (Math.abs(z % 30) < 5) {
            spawnLamp(3, z);
            spawnLamp(-3, z);
        }

        // Boorpunten
        if (Math.abs(z % 40) < 5 && z < -20) {
            spawnDrillPoint(z);
        }
    }

    function spawnHouse(x, z) {
        const houseGroup = new THREE.Group();
        const h = 4 + Math.random() * 3;
        const body = new THREE.Mesh(new THREE.BoxGeometry(5, h, 5), new THREE.MeshPhongMaterial({ color: Math.random() > 0.5 ? 0x8d6e63 : 0x546e7a }));
        body.position.y = h/2;
        houseGroup.add(body);

        const roof = new THREE.Mesh(new THREE.ConeGeometry(4.5, 3, 4), new THREE.MeshPhongMaterial({ color: 0xffffff }));
        roof.position.y = h + 1.5;
        roof.rotation.y = Math.PI / 4;
        houseGroup.add(roof);

        houseGroup.position.set(x, 0, z);
        environmentGroup.add(houseGroup);
    }

    function spawnTree(x, z) {
        const tree = new THREE.Group();
        const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.2, 0.2, 1), new THREE.MeshPhongMaterial({ color: 0x3e2723 }));
        trunk.position.y = 0.5;
        tree.add(trunk);

        for(let i=0; i<3; i++) {
            const leaves = new THREE.Mesh(new THREE.ConeGeometry(1.5 - i*0.3, 2, 8), new THREE.MeshPhongMaterial({ color: 0x2d5a27 }));
            leaves.position.y = 1.5 + i*1.2;
            tree.add(leaves);
            
            // Sneeuw op boom
            const snow = new THREE.Mesh(new THREE.ConeGeometry(1.6 - i*0.3, 0.5, 8), new THREE.MeshPhongMaterial({ color: 0xffffff }));
            snow.position.y = 1.2 + i*1.2;
            tree.add(snow);
        }

        tree.position.set(x, 0, z);
        environmentGroup.add(tree);
    }

    function spawnLamp(x, z) {
        const lamp = new THREE.Group();
        const pole = new THREE.Mesh(new THREE.CylinderGeometry(0.1, 0.1, 5), new THREE.MeshPhongMaterial({ color: 0x333333 }));
        pole.position.y = 2.5;
        lamp.add(pole);
        
        const lightBox = new THREE.Mesh(new THREE.BoxGeometry(0.4, 0.2, 0.6), new THREE.MeshPhongMaterial({ color: 0x333333 }));
        lightBox.position.set(x > 0 ? -0.3 : 0.3, 5, 0);
        lamp.add(lightBox);

        const light = new THREE.PointLight(0xf1c40f, 1, 10);
        light.position.set(x > 0 ? -0.3 : 0.3, 4.8, 0);
        lamp.add(light);

        lamp.position.set(x, 0, z);
        environmentGroup.add(lamp);
    }

    function spawnDrillPoint(z) {
        const marker = new THREE.Mesh(new THREE.CircleGeometry(1.2, 32), new THREE.MeshBasicMaterial({ color: 0xff3333, transparent: true, opacity: 0.6 }));
        marker.rotation.x = -Math.PI / 2;
        marker.position.set((Math.random() - 0.5) * 2, 0.05, z);
        scene.add(marker);
        drillPoints.push({ mesh: marker, drilled: false });
    }

    function setupControls() {
        window.onkeydown = e => {
            const k = e.key.toLowerCase();
            if (k === 'arrowleft' || k === 'a') keys.left = true;
            if (k === 'arrowright' || k === 'd') keys.right = true;
            if (k === 'arrowup' || k === 'w') keys.up = true;
            if (k === 's') keys.drill = true;
        };
        window.onkeyup = e => {
            const k = e.key.toLowerCase();
            if (k === 'arrowleft' || k === 'a') keys.left = false;
            if (k === 'arrowright' || k === 'd') keys.right = false;
            if (k === 'arrowup' || k === 'w') keys.up = false;
            if (k === 's') keys.drill = false;
        };

        const setupBtn = (id, key) => {
            const el = document.getElementById(id);
            const start = (e) => { e.preventDefault(); keys[key] = true; };
            const end = (e) => { e.preventDefault(); keys[key] = false; };
            el.addEventListener('touchstart', start, {passive: false});
            el.addEventListener('touchend', end, {passive: false});
            el.addEventListener('mousedown', start);
            el.addEventListener('mouseup', end);
        };
        setupBtn('left-btn', 'left');
        setupBtn('right-btn', 'right');
        setupBtn('up-btn', 'up');
        setupBtn('drill-btn', 'drill');
    }

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        isStarted = true;
    }

    function animate() {
        requestAnimationFrame(animate);
        if (isStarted && !isGameOver) {
            slipFactor = 1.0 + (distance / 40);
            document.getElementById('slip-val').innerText = slipFactor.toFixed(1);
            document.getElementById('dist-val').innerText = Math.floor(distance);

            // Oneindige omgeving genereren
            if (player.position.z < lastZPos - 15) {
                lastZPos -= 15;
                spawnEnvironmentRow(lastZPos - 100);
            }

            // Baby mood swings
            if (Math.random() < 0.015) babyMood = Math.random() > 0.5 ? 1 : 0;
            const babyWobble = babyMood === 1 ? Math.sin(Date.now() * 0.012) * 0.12 : 0;
            baby.position.x = babyWobble;
            document.getElementById('baby-status').innerText = babyMood === 1 ? "WIEBELIG!" : "Slapend";
            document.getElementById('baby-status').style.color = babyMood === 1 ? "#e74c3c" : "#2c3e50";

            // Balans berekening
            let drift = (Math.random() - 0.5) * 0.012 * slipFactor;
            balance += drift + (balance * 0.016 * slipFactor) + (babyWobble * 0.06);

            if (keys.left) balance -= 0.035;
            if (keys.right) balance += 0.035;

            // Boren check
            let nearDrill = drillPoints.find(p => !p.drilled && Math.abs(player.position.z - p.mesh.position.z) < 1.2 && Math.abs(player.position.x - p.mesh.position.x) < 1.0);

            if (keys.drill && nearDrill) {
                isDrilling = true;
                drillProgress += 2.0;
                document.getElementById('drill-progress-container').style.display = 'block';
                document.getElementById('drill-progress-bar').style.width = drillProgress + '%';
                
                if (drillProgress >= 100) {
                    nearDrill.drilled = true;
                    nearDrill.mesh.material.color.set(0x2ecc71);
                    drilledCount++;
                    document.getElementById('drill-count').innerText = drilledCount;
                    drillProgress = 0;
                    isDrilling = false;
                    document.getElementById('drill-progress-container').style.display = 'none';
                }
            } else {
                isDrilling = false;
                drillProgress = 0;
                document.getElementById('drill-progress-container').style.display = 'none';
                if (keys.up) {
                    distance += 0.12;
                    player.position.z -= 0.12;
                    player.position.y = Math.abs(Math.sin(distance * 5)) * 0.05;
                }
            }

            player.rotation.z = balance * 0.75;
            player.position.x = balance * 1.8;

            if (Math.abs(balance) > 1.25) {
                isGameOver = true;
                document.getElementById('game-over-screen').style.display = 'block';
                document.getElementById('death-reason').innerText = "Je gleed uit in de woonwijk! " + (drilledCount < 2 ? "Je hebt de buren niet geholpen met boren..." : "Minstens heb je " + drilledCount + " gaten geboord voor het zout.");
            }

            camera.position.set(player.position.x * 0.6, 2.5, player.position.z + 5);
            camera.lookAt(0, 1.0, player.position.z - 3);
        }

        if (isGameOver) {
            player.rotation.z += (balance > 0 ? 0.15 : -0.15);
            if (player.position.y > 0.2) player.position.y -= 0.1;
        }

        renderer.render(scene, camera);
    }

    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    init();
</script>
</body>
</html>

